\documentclass[12pt]{article}
\usepackage{amsfonts}
\usepackage[hscale=0.8,vscale=0.8]{geometry}
\usepackage{hyperref}

\begin{document}

\title{Notes on HJM Framework}
\date{Dec. 32, 2999}

\maketitle

\section{Formulation}

  Let $P(t,T)$ denotes the time $t$ price of a zero coupon bond which pays 1 at time $T$, {\it i.e.},
  \begin{equation}
    P(t,T)=E_t^Q\left[\exp\left(-\int_t^T r(u)du\right)\right],
    \label{bond0}
  \end{equation}
  where $Q$ stands for the risk neutral measure, and $r(t)$ is the short rate. Then, under the same measure \cite{AP},
  \begin{equation}
    \label{bond1}
    \frac{dP(t,T)}{P(t,T)}=r(t)dt-\sigma_P(t,T)^{{\top}}dW(t),
  \end{equation}
  where $W$ is a $d$-dimensional Brownian motion, $\sigma_P(t,T)$ is a
  $d$-dimensional stochastic process adapted to the filtration generated by $W$,
  and $\top$ represents matrix transposition. Here, $\sigma_P(t,T)$ must
  satisfy the consistency condition, $\sigma_P(T,T)=0$, since $P(T,T)=1$.

  Define the forward discount bond price as
  \begin{equation}
    P(t,T,T+\tau)=\frac{P(t,T+\tau)}{P(t,T)},
  \end{equation}
  and apply the Ito's lemma, then
  \begin{equation}
    \label{bond2}
    \frac{dP(t,T,T+\tau)}{P(t,T,T+\tau)}=-\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]\sigma_P(t,T)dt
                                        -\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]dW(t),
  \end{equation}
  under the risk neutral measure. Under the $T$-forward measure, the forward discount bond price is a martingale,
  which means
  \begin{equation}
    \label{bond3}
    \frac{dP(t,T,T+\tau)}{P(t,T,T+\tau)}=-\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]dW^T(t).
  \end{equation}

  Define the forward rate as
  \begin{equation}
    f(t,T)=-\frac{\partial\log P(t,T)}{\partial T},
  \end{equation}
  then from Eq. (\ref{bond1}), the forward rate has the following dynamics,
  \begin{equation}
    \label{rate}
    df(t,T)=\sigma_f(t,T)^{\top}\sigma_P(t,T)dt+\sigma_f(t,T)^{\top}dW(t),
  \end{equation}
  where $\sigma_f(t,T)=\partial\sigma_P(t,T)/\partial T$, or equivalently,
  $\sigma_P(t,T)=\int_t^T\sigma_f(t,u)du$.


\section{Markovian Short Rate Dynamics}

  From Eq. (\ref{rate}), the forward rate is given by
  \begin{equation}
    f(t,T)=f(0,T)+\int_0^t\sigma_f(u,T)^{\top}\left(\int_u^T\sigma_f(u,s)ds\right)du+\int_0^t\sigma_f(u,T)^{\top}dW(u).
  \end{equation}
  Define the short rate as $r(t)=f(t,t)$, then the short rate dynamics becomes
  \begin{equation}
    r(t)=f(0,t)+\int_0^t\sigma_f(u,t)^{\top}\left(\int_u^t\sigma_f(u,s)ds\right)du+\int_0^t\sigma_f(u,t)^{\top}dW(u).
  \end{equation}
  Generally, the short rate process is not Markovian. However, after imposing the separation condition
  $\sigma_f(t,T)=g(t)h(T)$, where $g(t)\equiv g(t;\omega)$ is a $d\times d$ matrix valued function, which can
  be deterministic or stochastic, and $h$ is a
  deterministic $d$-dimensional column vector function, the short rate will be Markovian. Under this condition,
  \begin{equation}
    r(t)=f(0,t)+h(t)^{\top}\int_0^tg(u)^{\top}g(u)\left(\int_u^th(s)ds\right)du+h(t)^{\top}\int_0^tg(u)^{\top}dW(u).
  \end{equation}

  To cast the short rate dynamics into a convenient form, define
  \begin{equation}
    H(t)={\rm diag}(h_1(t),...,h_d(t))=\left(
      \begin{array}{ccc}
        h_1(t) & & 0 \\
          & \ddots & \\
          0 & & h_d(t)
      \end{array}
    \right),
  \end{equation}
  and
  \begin{equation}
    \kappa(t) = -\frac{dH(t)}{dt}H^{-1}(t).
  \end{equation}
  Here, we have assumed that none of the $h_i$ is zero. Later it will be shown that the diagonal elements of $\kappa(t)$
  are the mean reversion parameter for the short rate dynamics. Now, define
  \begin{equation}
    x(t)=H(t)\int_0^tg(u)^{\top}g(u)\left(\int_u^th(s)ds\right)du+H(t)\int_0^tg(u)^{\top}dW(u),
  \end{equation}
  and
  \begin{equation}
    y(t)=H(t)\left(\int_0^tg(u)^{\top}g(u)du\right)H(t),
    \label{y}
  \end{equation}
  then it can be shown
  \begin{equation}
    dy(t) = \bigg(\sigma_r(t;\omega)^{\top}\sigma_r(t;\omega) - \kappa(t)y(t) - y(t)\kappa(t)\bigg)dt,
  \end{equation}
  with $\sigma_r(t;\omega)=g(t;\omega)H(t)$, which is locally deterministic and can be solved numerically and analytically, if possible. Also,
  \begin{eqnarray}
    dx(t) &=& \left[\frac{dH(t)}{dt}\int_0^tg(u)^{\top}g(u)\left(\int_u^th(s)ds\right)du\right]dt
            + \left[H(t)\left(\int_0^tg(u)^{\top}g(u)du\right)h(t)dt\right]\nonumber\\
          &&+ \frac{dH(t)}{dt}\left(\int_0^tg(u)^{\top}dW(u)\right)dt
            + H(t)g(t)^{\top}dW(t)\nonumber\\
          &=& \bigg(y(t)I_{d\times 1}-\kappa(t)x(t)\bigg)dt+H(t)g(t)^{\top}dW(t)\nonumber\\
          &=& \bigg(y(t)I_{d\times 1}-\kappa(t)x(t)\bigg)dt+\sigma_r(t;\omega)^{\top}dW(t),
          \label{x}
  \end{eqnarray}
  where $I_{d\times 1}=(1,1,...,1)^{\top}$. The $x$ and $y$ processes have
  initial conditions $x(0)=0$ and $y(0)=0$, which is evident from their definitions. It can be shown,
  by Ritchken and Sankarasubramanian, that any interest rate derivative will be completely determined
  by the two-state Markovian process $(x(t), y(t))$.

  Using the above parameterizations, it can be shown, for forward rate,
  \begin{eqnarray}
    f(t,T) &=& f(0,T)+I_{d\times 1}^{\top}H(T)^{\top}\int_0^tg(u)^{\top}g(u)\left(\int_u^Th(s)ds\right)du
              +I_{d\times 1}^{\top}H(T)\int_0^tg(u)^{\top}dW(u)\nonumber\\
           &=& f(0,T)+I_{d\times 1}^{\top}H(T)\int_0^tg(u)^{\top}g(u)\left(\int_u^th(s)ds\right)du
              +I_{d\times 1}^{\top}H(T)\int_0^tg(u)^{\top}dW(u)\nonumber\\
           && + I_{d\times 1}^{\top}H(T)\int_0^tg(u)^{\top}g(u)\left(\int_t^Th(s)ds\right)du\nonumber\\
           &=& f(0,T)+I_{d\times 1}^{\top}H(T)H^{-1}(t)\Big(H(t)\int_0^tg(u)^{\top}g(u)\left(\int_u^th(s)ds\right)du\nonumber\\
           &&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +H(t)\int_0^tg(u)^{\top}dW(u)\Big)\nonumber\\
           && + I_{d\times 1}^{\top}H(T)H^{-1}(t)H(t)\int_0^tg(u)^{\top}g(u)\left(\int_t^Th(s)ds\right)du\nonumber\\
           &=& f(0,T)+M(t,T)^{\top}\left(x(t)+y(t)\int_t^TM(t,u)du\right),
  \end{eqnarray}
  where
  \begin{equation}
    M(t,T)=H(T)H^{-1}(t)I_{d\times 1}.
  \end{equation}
  From this, the short rate is given by
  \begin{equation}
    r(t)=f(t,t)=f(0,t)+I_{d\times 1}^{\top}x(t)=f(0,t)+\sum_{i=1}^dx_i(t).
  \end{equation}


  From the above result, we can also derive the bond reconstitution formula. Notice $P(t,T)=\exp\left(-\int_t^Tf(t,u)du\right)$, we have
  \begin{eqnarray}
    P(t,T)&=&\exp\Bigg(-\int_t^Tf(0,u)du-\left(\int_t^TM(t,u)^{\top}du\right)x(t) \nonumber\\
          &&\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ -\int_t^TM(t,u)^{\top}y(t)\left(\int_t^uM(t,s)ds\right)du\Bigg).
  \end{eqnarray}
  Define
  \begin{equation}
    G(t,T)=\int_t^TM(t,u)du,
  \end{equation}
  and notice that
  \begin{equation}
    \int_t^TM(t,u)^{\top}y(t)\left(\int_t^uM(t,s)ds\right)du = \int_t^TM(t,u)^{\top}y(t)\left(\int_u^TM(t,s)ds\right)du,
  \end{equation}
  the bond reconstitution formula can be rewritten as
  \begin{equation}
    P(t,T)=\frac{P(0,T)}{P(0,t)}\exp\left(-G(t,T)^{\top}x(t)-\frac{1}{2}G(t,T)^{\top}y(t)G(t,T)\right).
    \label{reconstitution}
  \end{equation}

  The density relating the $T$-forward measure and the risk neutral measure is given by
  \begin{equation}
    \zeta(t)=E_t^Q\left[\frac{dP^T}{dP}\right]=\frac{P(t,T)/P(0,T)}{B(t)/B(0)},
  \end{equation}
  where $B(t)=\exp\left(\int_0^tr(u)du\right)$ is the numeraire of the risk neutral measure.
  This density is a martingale in the risk neutral measure, and therefore,
  \begin{equation}
    \frac{d\zeta(t)}{\zeta(t)}=-G(t,T)^{\top}\sigma_r(t)^{\top}dW(t).
  \end{equation}
  The Brownian motion under the $T$-forward, following the Girsanov's theorem (see Appendix \ref{Girsanov}), is then given by
  \begin{equation}
    dW^T(t)=dW(t)+\sigma_r(t)G(t,T)dt.
    \label{Tmeasure}
  \end{equation}


\section{Closed Form Results for Gaussian Models}

  In the above formulation, when $\sigma_f(t,T)$ is a deterministic function,
  the resulting models will be Gaussian, where the distribution of the forward rate, and the short rate, will be Gaussian.
  This leads to simplifications to the modeling and pricing of interest rate derivatives, and even closed form expressions
  for several simple derivatives.

  \subsection{Zero Coupon Bond Option}

    Consider a call option with expiry $T$ and strike $K$ on a zero coupon bond with maturity $T^*$. At expiry, the
    option pays
    \begin{equation}
      V(T)=\left(P(T,T^*)-K\right)^+.
    \end{equation}
    Using the change of measure trick, the value of the zero coupon bond becomes
    \begin{equation}
      V(t)=E_t^Q\left[\exp\left(-\int_t^Tr(s)ds\right)V(T)\right]=P(t,T)E_t^T\left[\left(P(T,T,T^*)-K\right)^+\right],
    \end{equation}
    under the $T$-forward measure. Then, apply the Black-Scholes formula and take into account of Eq. (\ref{bond3}),
    \begin{eqnarray}
      V(t) &=& P(t,T)\left[P(t,T,T^*)N(d_+)-KN(d_-)\right] \nonumber\\
           &=& P(t,T^*)N(d_+) - KP(t,T)N(d_-),
      \label{zcbo}
    \end{eqnarray}
    where
    \begin{equation}
      d_{\pm} = \frac{\displaystyle\log\left(\frac{P(t,T,T^*)}{K}\right)\pm \frac{v}{2}}{\sqrt{v}}
             = \frac{\displaystyle\log\left(\frac{P(t,T^*)}{KP(t,T)}\right)\pm \frac{v}{2}}{\sqrt{v}},
    \end{equation}
    and
    \begin{equation}
      v=\int_t^T\left|\sigma_P(s,T^*)-\sigma_P(s,T)\right|^2ds.
    \end{equation}

  \subsection{Caplet}

    Now consider a caplet which resets at time $T$, and pays at $T+\tau$ the amount
    \begin{equation}
      V(T+\tau) = \tau\left(L(T,T+\tau)-K\right)^+,
    \end{equation}
    where $L(T,T+\tau)$ is the LIBOR rates spanning from $T$ to $T+\tau$, and $\tau$
    is the year fraction. The value of the caplet at time $t$ is
    \begin{equation}
      V(t)=E_t^Q\left[\exp\left(-\int_t^{T+\tau}r(s)ds\right)V(T+\tau)\right].
    \end{equation}
    Use the tower rule,
    \begin{eqnarray}
      V(t)&=&E_t^Q\left[\exp\left(-\int_t^{T}r(s)ds\right)E_T^Q\left[\exp\left(-\int_T^{T+\tau}r(s)ds\right)V(T+\tau)\right]\right]\nonumber\\
          &=&E_t^Q\left[\exp\left(-\int_t^{T}r(s)ds\right)P(T,T+\tau)V(T+\tau)\right].
    \end{eqnarray}
    Notice that $L(T,T+\tau)=\tau^{-1}(1/P(T,T+\tau)-1)$, the above expression becomes
    \begin{eqnarray}
      V(t)&=&E_t^Q\left[\exp\left(-\int_t^{T}r(s)ds\right)\left(1-\left(1+\tau K\right)P(T,T+\tau)\right)^+\right]\nonumber\\
          &=&(1+\tau K)E_t^Q\left[\exp\left(-\int_t^{T}r(s)ds\right)\left(\frac{1}{1+\tau K}-P(T,T+\tau)\right)^+\right].
    \end{eqnarray}
    Now, the caplet price has been turned into a put option on a zero coupon bond. Using the earlier result, the caplet price is
    \begin{eqnarray}
      V(t)&=&(1+\tau K)P(t,T)\left(\frac{1}{1+\tau K}N(-d_-)-P(T,T+\tau)N(-d_+)\right)\nonumber\\
          &=&P(t,T)N(-d_-)-(1+\tau K)P(t,T+\tau)N(-d_+),
    \end{eqnarray}
    where
    \begin{equation}
      d_{\pm} = \frac{\displaystyle\log\left(\frac{(1+\tau K)P(t,T+\tau)}{P(t,T)}\right)\pm \frac{v}{2}}{\sqrt{v}},
    \end{equation}
    and
    \begin{equation}
      v=\int_t^T\left|\sigma_P(s,T+\tau)-\sigma_P(s,T)\right|^2ds.
    \end{equation}

  \subsection{Futures}

    The futures rate is a martingale under the risk neutral measure, {\it i.e.}, $F(t,T,T+\tau)=E_t^Q[L(T,T,T+\tau)]$.
    This is equivalent to
    \begin{equation}
      F(t,T,T+\tau)=\frac{1}{\tau}E_t^Q\left[\frac{1}{P(T,T+\tau)}-1\right].
    \end{equation}
    The dynamics of $G(t)=1/P(t,T,T+\tau)=P(t,T)/P(t,T+\tau)$ under the risk neutral measure is
    \begin{eqnarray}
      d\left(\frac{1}{P(t,T,T+\tau)}\right)&=&-\frac{dP(t,T,T+\tau)}{P^2(t,T,T+\tau)}+\frac{\left(dP(t,T,T+\tau)\right)^2}{P^3(t,T,T+\tau)}\nonumber\\
                &=&\frac{1}{P(t,T,T+\tau)}\Big(\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]\sigma_P(t,T)dt\nonumber\\
                && \ \ \ \ \ \ \ \ \ \ \ \ \ \ \  \ \ \ \ +\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]dW(t)\Big)\nonumber\\
                && + \frac{1}{P(t,T,T+\tau)}\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]\left[\sigma_P(t,T+\tau)-\sigma_P(t,T)\right]dt\nonumber\\
                &=&\frac{1}{P(t,T,T+\tau)}\Big(\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]\sigma_P(t,T+\tau)dt\nonumber\\
                && \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ +\left[\sigma_P(t,T+\tau)^{\top}-\sigma_P(t,T)^{\top}\right]dW(t)\Big).
    \end{eqnarray}
    Therefore,
    \begin{equation}
      E_t^Q\left[\frac{1}{P(T,T+\tau)}\right]=\frac{1}{P(t,T,T+\tau)}e^{\Omega(t,T)},
    \end{equation}
    where
    \begin{equation}
      \Omega(t,T)=\int_t^T\left[\sigma_P(u,T+\tau)^{\top}-\sigma_P(u,T)^{\top}\right]\sigma_P(u,T+\tau)du.
    \end{equation}
    So, the futures rate is
    \begin{eqnarray}
      F(t,T,T+\tau)&=&\frac{1}{\tau}\left(\frac{1}{P(t,T,T+\tau)}e^{\Omega(t,T)}-1\right)\nonumber\\
                   &=&L(t,T,T+\tau) + \left(\frac{1}{\tau}+L(t,T,T+\tau)\right)\left(e^{\Omega(t,T)}-1\right),
      \label{ca}
    \end{eqnarray}
    where the last term is the futures convexity adjustment in Gaussian short rate models.

  \subsection{European Swaption - Jamshidian Decomposition}

  The above results do not make any specific assumptions besides of the Gaussianness, and can be applied to general models with
  deterministic forward rate volatility functions. The trick, Jamshidian decomposition,
  which will be introduced in the following relies on the monotonicity of the zero coupon bond price on short rate.

  Consider a payer swaption expiring at $T_0$, with the underlying swap paying annualized coupon $c$ at times
  $T_1<T_2<\cdots<T_N$, with $T_1>T_0$. The swaption payout at $T_0$ is
  \begin{equation}
    V(T_0) = \left(1-P(T_0,T_N)-c\sum_{i=1}^N\tau_iP(T_0,T_i)\right)^+,
  \end{equation}
  where $\tau_i=T_i-T_{i-1}$ is the accrual period. Notice the dependence of the zero coupon bond price on $x$, {\it i.e.},
  $P(T_0,T_N)\equiv P(T_0,T_N;x(T_0))$, through the bond reconstitution formula, Eq. (\ref{reconstitution}). Define a
  critical value $x^*$ by setting the value of the swaption at time $T_0$ to exactly zero,
  \begin{equation}
    P(T_0,T_N;x^*)+c\sum_{i=1}^N\tau_iP(T_0,T_i;x^*)=1.
  \end{equation}
  Also define the ``strikes" as
  \begin{equation}
    K_i=P(T_0,T_i;x^*),
  \end{equation}
  then
  \begin{equation}
    K_N+c\sum_{i=1}^N\tau_iK_i=1.
  \end{equation}
  Notice that $P(T_0,T_i;x(T_0))$ is monotonically decreasing in $x(T_0)$, which always holds due to the bond reconstitution
  formula (\ref{reconstitution}), we have
  \begin{eqnarray}
    V(T_0)&=&\left(1-P(T_0,T_N;x(T_0))-c\sum_{i=1}^N\tau_iP(T_0,T_i;x(T_0))\right)^+\nonumber\\
          &=&\left(1-P(T_0,T_N;x(T_0))-c\sum_{i=1}^N\tau_iP(T_0,T_i;x(T_0))\right)\textbf{1}_{x(T_0)>x^*}\nonumber\\
          &=&\left(K_N+c\sum_{i=1}^N\tau_iK_i-P(T_0,T_N;x(T_0))-c\sum_{i=1}^N\tau_iP(T_0,T_i;x(T_0))\right)\textbf{1}_{x(T_0)>x^*}\nonumber\\
          &=&\left(K_N-P(T_0,T_N;x(T_0))\right)\textbf{1}_{x(T_0)>x^*}
                    + c\sum_{i=1}^N\tau_i\left(K_i-P(T_0,T_i;x(T_0))\right)\textbf{1}_{x(T_0)>x^*}\nonumber\\
          &=&\left(K_N-P(T_0,T_N;x(T_0))\right)^+
       + c\sum_{i=1}^N\tau_i\left(K_i-P(T_0,T_i;x(T_0))\right)^+.
  \end{eqnarray}
  Then, this can be evaluated with the zero coupon bond option price formula, Eq. (\ref{zcbo}).
  This trick can also be applied to coupon bond options.

\section{Examples of Classical Gaussian Short Rate Models - One Factor Models}

  By setting $d=1$ in the above formulation, we will obtain one-factor models. Since the matrix products will be reduced to
  scalar products, this will greatly simplify the discussion.

  \subsection{Ho-Lee Model}

  The Ho-Lee model can be recovered by taking $h(t)=1$, and $g(t)=\sigma$ which is constant. It is straightforward to show that
  $\kappa(t)=0$, $y(t)=\sigma^2t$,
  \begin{equation}
    dx(t)=\sigma^2tdt+\sigma dW(t),
  \end{equation}
  and $r(t)=f(0,t)+x(t)$. Also, the forward rate volatility is $\sigma_f(t,T)=\sigma$, which is constant too, $\sigma_P(t,T)=\sigma(T-t)$, and the bond
  reconstitution formula is
  \begin{eqnarray}
    P(t,T)&=&\frac{P(0,T)}{P(0,t)}\exp\left(-x(t)(T-t)-\frac{1}{2}\sigma^2(T-t)^2t\right)\nonumber\\
          &=&\frac{P(0,T)}{P(0,t)}\exp\left(-\left(r(t)-f(0,t)\right)(T-t)-\frac{1}{2}\sigma^2(T-t)^2t\right).
  \end{eqnarray}


  \subsection{Hull-White Model}

  Take $h(t)=\exp\left(-\int_0^t\kappa(u)du\right)$, and $g(t)=\sigma(t)\exp\left(\int_0^t\kappa(u)du\right)$, then we have
  \begin{equation}
    \frac{dy(t)}{dt} = \sigma^2(t) - 2\kappa(t)y(t),
  \end{equation}
  which has the following analytical solution,
  \begin{equation}
    y(t)=\int_0^t\sigma^2(u)\exp\left(-2\int_u^t\kappa(s)ds\right)du,
  \end{equation}
  Then,
  \begin{equation}
    dx(t)=\left(y(t)-\kappa(t)x(t)\right)dt+\sigma(t)dW(t),
  \end{equation}
  which can be shown to have the following solution,
  \begin{equation}
    x(t)=\int_0^ty(u)\exp\left(-\int_u^t\kappa(s)ds\right)du+\int_0^t\sigma(u)\exp\left(-\int_u^t\kappa(s)ds\right)dW(u).
  \end{equation}
  Also,
  \begin{equation}
    \sigma_f(t,T)=g(t)h(T)=\sigma(t)\exp\left(-\int_t^T\kappa(u)du\right),
  \end{equation}
  and
  \begin{equation}
    \sigma_P(t,T)=\int_t^T\sigma_f(t,u)du=\int_t^T\sigma(t)\exp\left(-\int_t^u\kappa(s)ds\right)du.
  \end{equation}
  Moreover,
  \begin{equation}
    M(t,T)=\frac{h(T)}{h(t)}=\exp\left(-\int_t^T\kappa(u)du\right),
  \end{equation}
  and
  \begin{equation}
    G(t,T)=\int_t^TM(t,u)du=\int_t^T\exp\left(-\int_t^u\kappa(s)ds\right)du.
  \end{equation}
  The bond reconstitution formula follows Eq. (\ref{reconstitution}).

  The Vasicek model can be recovered by setting $\kappa$ and $\sigma$ to constants, and the mathematical details will not be reproduced here.


  \subsection{Mercurio-Moraleda Model}

  The Mercurio-Moraleda model \cite{BM} can be obtained by setting
  \begin{equation}
    \kappa(t)=\lambda-\frac{\gamma}{1+\gamma t},
  \end{equation}
  then
  \begin{equation}
    h(t)=\left(1+\gamma t\right)e^{-\lambda t},
  \end{equation}
  and
  \begin{equation}
    g(t)=\sigma\frac{e^{\lambda t}}{1+\gamma t}.
  \end{equation}
  The forward rate volatility is given by
  \begin{equation}
    \sigma_f(t,T)=g(t)h(T)=\sigma\frac{1+\gamma T}{1+\gamma t}e^{-\lambda(T-t)},
    \label{MM}
  \end{equation}
  which satisfies the separability condition, and the short rate dynamics will be Markovian. Moreover, this volatility specification can also generate
  a humped shape in the volatility term structure, which is often observed in the cap market. However, the above dynamics is not time-stationary.
  This can be addressed by expanding the forward volatility to the first order in $\gamma$, leading to the following expression,
  \begin{equation}
    \sigma_f(t,T)=\sigma\Big[1+\gamma(T-t)\Big]e^{-\lambda(T-t)},
  \end{equation}
  sacrificing the Markov property of the short rate dynamics. In the following, we will focus on the volatility structure specified by Eq. (\ref{MM}).

  From Eq. (\ref{y}), we have
  \begin{eqnarray}
    y(t) &=& \int_0^t\sigma^2\exp\left(-2\int_u^t\kappa(s)ds\right)du\nonumber\\
         &=& \sigma^2\int_0^t\left(\frac{1+\gamma t}{1+\gamma u}\right)^2e^{-2\lambda(t-u)}du.
  \end{eqnarray}
  Notice that
  \begin{equation}
    \int \frac{e^{\lambda t}}{1+\gamma t}dt = \frac{e^{-\lambda/\gamma}}{\gamma}{\rm Ei}\left(\frac{\lambda}{\gamma}(1+\gamma t)\right) + {\rm const.},
  \end{equation}
  where
  \begin{equation}
    {\rm Ei}(x)=\int_{-\infty}^x\frac{e^t}{t}dt
  \end{equation}
  is the exponential integral function, it can be shown that
  \begin{eqnarray}
    y(t) &=& \frac{\sigma^2(1+\gamma t)}{\gamma^2}\left[2\lambda(1+\gamma t)\exp\left(\frac{2\lambda}{\gamma}(1+\gamma t)\right)
                      {\rm Ei}\left(\frac{2\lambda}{\gamma}(1+\gamma t)\right)-\gamma\right]\nonumber\\
         && \quad +\frac{\sigma^2(1+\gamma t)^2}{\gamma^2}\left[2\lambda\exp\left(\frac{2\lambda}{\gamma}(1+\gamma t)\right)
                      {\rm Ei}\left(\frac{2\lambda}{\gamma}\right)-\gamma e^{-2\lambda t}\right].
  \end{eqnarray}
  Also,
  \begin{equation}
    M(t,T)=\frac{h(T)}{h(t)}=\frac{1+\gamma T}{1+\gamma t}e^{-\lambda(T-t)},
  \end{equation}
  and
  \begin{eqnarray}
    G(t,T)&=&\int_t^TM(t,u)du=\frac{e^{\lambda t}}{1+\gamma t}\int_t^T(1+\gamma u)e^{-\lambda u}du\nonumber\\
          &=&\frac{1}{\lambda^2(1+\gamma t)}\Big[\gamma+\lambda+\gamma\lambda t - \left(\gamma+\lambda+\gamma\lambda T\right)e^{-\lambda(T-t)}\Big].
  \end{eqnarray}
  The bond reconstitution formula follows Eq. (\ref{reconstitution}).


\section{Examples of Classical Gaussian Short Rate Models - Multi Factor Models}

  As an example, let us consider the two factor Hull-White model in terms of the HJM framework. Define
  \begin{equation}
    g(t)=\left(
            \begin{array}{cc}
              \sigma_{11}(t)\exp\left\{\int_0^t\kappa_1(u)du\right\} & 0 \\
              \sigma_{21}(t)\exp\left\{\int_0^t\kappa_1(u)du\right\} & \sigma_{22}(t)\exp\left\{\int_0^t\kappa_2(u)du\right\}
            \end{array}
         \right),
  \end{equation}
  and
  \begin{equation}
    h(t)=\left(
            \begin{array}{c}
              \exp\left\{-\int_0^t\kappa_1(u)du\right\}\\
              \exp\left\{-\int_0^t\kappa_2(u)du\right\}
            \end{array}
         \right).
  \end{equation}
  Then,
  \begin{equation}
    \sigma_r(t)=g(t)H(t)=\left(
            \begin{array}{cc}
              \sigma_{11}(t) & 0 \\
              \sigma_{21}(t) & \sigma_{22}(t)
            \end{array}
         \right),
  \end{equation}
  and
  \begin{equation}
    dx(t)=\Big(y(t)I_{2\times 1}-\kappa(t)x(t)\Big)dt+\sigma_r(t)^{{\top}}dW(t),
  \end{equation}
  where $y(t)$ can be found by numerical integration, and $\kappa(t)={\rm diag}(\kappa_1(t),\kappa_2(t))$. The short rate can be
  written as
  \begin{equation}
    r(t)=f(0,t)+x_1(t)+x_2(t),
  \end{equation}

  Define
  $\sigma_1(t)=\sqrt{\sigma_{11}^2(t)+\sigma_{21}^2(t)}$, $\sigma_2(t)=\sigma_{22}(t)$, and
  \begin{equation}
    \rho_x(t)=\frac{\sigma_{21}(t)\sigma_{22}(t)}{\sigma_1(t)\sigma_2(t)},
  \end{equation}
  then the correlation in forward rates can be expressed in these three parameters, together with $\kappa_1(t)$
  and $\kappa_2(t)$. For the forward rate, we have
  \begin{equation}
    \sigma_f(t,T)=g(t)h(T)=\left(
            \begin{array}{l}
              \sigma_{11}(t)\exp\left\{-\int_t^T\kappa_1(u)du\right\}\\
              \sigma_{21}(t)\exp\left\{-\int_t^T\kappa_1(u)du\right\}+\sigma_{22}(t)\exp\left\{-\int_t^T\kappa_2(u)du\right\}
            \end{array}
         \right),
  \end{equation}
  and
  \begin{equation}
    df(t,T)=O(dt)+\sigma_f(t,T)^{{\top}}dW(t).
  \end{equation}
  The covariance of the forward rates maturing at $T_1$ and $T_2$ is
  \begin{eqnarray}
    && \frac{\langle df(t,T_1), df(t,T_2)\rangle}{dt} \nonumber\\
    &=& \left(\sigma_{11}^2(t)+\sigma_{21}^2(t)\right)\exp\left\{-\int_t^{T_1}\kappa_1(u)du-\int_t^{T_2}\kappa_1(u)du\right\}\nonumber\\
    && \quad +\sigma_{22}^2(t)\exp\left\{-\int_t^{T_1}\kappa_2(u)du-\int_t^{T_2}\kappa_2(u)du\right\}\nonumber\\
    && \quad +\sigma_{21}(t)\sigma_{22}(t)\Bigg(\exp\left\{-\int_t^{T_1}\kappa_1(u)du-\int_t^{T_2}\kappa_2(u)du\right\} \nonumber\\
    && \quad\quad\quad\quad\quad\quad\quad\quad +\exp\left\{-\int_t^{T_1}\kappa_2(u)du-\int_t^{T_2}\kappa_1(u)du\right\}\Bigg)\nonumber\\
    &=& \sigma_1^2(t)\exp\left\{-\int_t^{T_1}\kappa_1(u)du-\int_t^{T_2}\kappa_1(u)du\right\}b(t,T_1,T_2),
  \end{eqnarray}
  where
  \begin{eqnarray}
    b(t,T_1,T_2)&=&1+\rho_x(t)\frac{\sigma_2(t)}{\sigma_1(t)}\Bigg(\exp\left\{-\int_t^{T_1}\left(\kappa_2(u)-\kappa_1(u)\right)du\right\}\nonumber\\
                && \quad\quad\quad\quad\quad\quad\quad\quad +\exp\left\{-\int_t^{T_2}\left(\kappa_2(u)-\kappa_1(u)\right)du\right\}\Bigg)\nonumber\\
                && +\left(\frac{\sigma_2(t)}{\sigma_1(t)}\right)^2\exp\left\{-\int_t^{T_1}\left(\kappa_2(u)-\kappa_1(u)\right)du
                                                                            -\int_t^{T_2}\left(\kappa_2(u)-\kappa_1(u)\right)du\right\}.
  \end{eqnarray}
  Therefore, the correlation between the forward rates is given by
  \begin{equation}
    \rho(t,T_1,T_2)=\frac{b(t,T_1,T_2)}{\sqrt{b(t,T_1,T_1)b(t,T_2,T_2)}}.
  \end{equation}
  It is clear from the above expression that the correlation of the forward rates can be controlled by the five functions: $\rho_x(t)$,
  $\sigma_1(t)$, $\sigma_2(t)$, $\kappa_1(t)$, and $\kappa_2(t)$. If we have either $\rho_x=1$, $\kappa_2(t)-\kappa_1(t)=0$, or $\sigma_2(t)/\sigma_1(t)=0$,
  then $\rho(t,T_1,T_2)\equiv 1$, where the model reduces to a one-factor one. Also,
  \begin{equation}
    \frac{\langle df(t,T), df(t,T)\rangle}{dt}=\sigma_1^2(t)\exp\left\{-2\int_t^{T}\kappa_1(u)du\right\}b(t,T,T),
  \end{equation}
  it can be shown that if $\rho_x$ is negative enough, the term structure of the volatility will develop a humped shape.


\section{The Quasi-Gaussian Models}

  We are going to consider general multi-factor quasi-Gaussian models, with the separation condition $\sigma_f(t,T;\omega)=g(t;\omega)h(T)$,
  where $g(t;\omega)$ is a $d\times d$-matrix valued function, and $h(t)$ is a deterministic, $d$-dimensional column vector function.
  We are going to develop efficient approximation for the swap rate, which will also cover the pure Gaussian case.

  \subsection{Approximate Swap Rate Dynamics}
  \label{qGS}

    Consider the following volatility specification which contains both local and stochastic volatilities,
    \begin{equation}
      \sigma_r(t;\omega) = \sqrt{z(t)}\sigma_x(t,x(t), y(t)),
    \end{equation}
    where $z(t)$ follows the CIR process
    \begin{equation}
      dz(t)=\theta(z_0-z(t))dt+\eta(t)\sqrt{z(t)}dZ(t),\quad\quad z(0)=z_0=1,
    \end{equation}
    and $\langle dZ(t),dW(t)\rangle=0$.

    To proceed with the swap rate dynamics, fix a tenor structure
    \begin{equation}
      0<T_0<T_1<\cdots<T_N
    \end{equation}
    with
    \begin{equation}
      \tau_n=T_{n+1}-T_n,
    \end{equation}
    and the swap rate $S(t)$, with first fix date at $T_0$ and last payment date at $T_N$, is given by
    \begin{equation}
      S(t)=\frac{P(t,T_0)-P(t,T_N)}{A(t)},\quad\quad A(t)=\sum_{n=0}^{N-1}\tau_nP(t,T_{n+1}).
    \end{equation}
    Notice the functional dependence of the discount bond $P(t,T)$ on the state variables $x$ and $y$,
    {\it i.e.}, $P(t,T)\equiv P(t,T,x(t),y(t))$, the swap rate dynamics is
    \begin{equation}
      dS(t) = \sqrt{z(t)} (\nabla S) \sigma_x^{\top}dW(t) + O(dt),
    \end{equation}
    where we are only concerned with the drift term. Since the swap rate is a martingale in the annuity
    measure, its dynamics in the corresponding annuity measure is given by
    \begin{equation}
      dS(t) = \sqrt{z(t)}\bigg((\nabla S) \sigma_x^{\top}\sigma_x (\nabla S)^{\top} \bigg)^{1/2} dW^A(t).
    \end{equation}

    Using the Markovian Projection (MP) method, the above process is equivalent to the following local volatility
    process in terms of European option pricing,
    \begin{equation}
      dS(t) = \sqrt{z(t)}\varphi(t,S(t)) dW^A(t),
    \end{equation}
    where
    \begin{equation}
      \varphi^2(t,s) = E^A\bigg[\left.(\nabla S) c_x (\nabla S)^{\top}\right|S(t)=s\bigg],
      \label{local}
    \end{equation}
    and $c_x=\sigma_x^{\top}\sigma_x$.

    We will look for the linear approximation to $\varphi(t,s)$ in $s$, and will use $E^A(x(t))$ and $E^A(y(t))$
    as expansion point. First, define
    \begin{equation}
      \sigma_x^0(t)=\sigma_x(t,0,0),
    \end{equation}
    then from Eq. (\ref{y}), we have
    \begin{equation}
      y(t)=H(t)\left(\int_0^tH^{-1}(u)\sigma_r(u)^{\top}\sigma_r(u)H^{-1}(u)du\right)H(t),
    \end{equation}
    and
    \begin{equation}
      \bar{y}(t)= E^A\left[y(t)\right] \approx H(t)\left(\int_0^tH^{-1}(u)\left(\sigma_x^0(u)\right)^{\top}\sigma_x^0(u)H^{-1}(u)du\right)H(t).
    \end{equation}
    For the approximation of $x(t)$, replace $y(t)$ with $\bar{y}(t)$ in Eq. (\ref{x}), which is the Gaussian approximation
    to $x(t)$,
    \begin{equation}
      dx_g(t)=\bigg(\bar{y}(t)I_{d \times 1}-\kappa(t)x_g(t)\bigg)dt+\left(\sigma_x^0(t)\right)^{\top}dW(t).
    \end{equation}
    The corresponding dynamics for $x_g(t)$ in the $T$-forward measure, using Eq. (\ref{Tmeasure}), is
    \begin{equation}
      dx_g(t)=\bigg(\bar{y}(t)I_{d \times 1}-\left(\sigma_x^0(t)\right)^{\top}\sigma_x^0(t)G(t,T)-\kappa(t)x_g(t)\bigg)dt
                                        +\left(\sigma_x^0(t)\right)^{\top}dW^T(t).
    \end{equation}
    The solution to the above SDE is
    \begin{equation}
      x_g(t)=H(t)\left(\int_0^tH^{-1}(u)\left[\left(\bar{y}(u)I_{d \times 1}-\left(\sigma_x^0(u)\right)^{\top}\sigma_x^0(u)G(u,T)\right)du
                        +\left(\sigma_x^0(t)\right)^{\top}dW^T(u)\right]\right),
    \end{equation}
    and
    \begin{eqnarray}
      \bar{x}(t) &=& E^A\left[x(t)\right]\approx E^A\left[x_g(t)\right]\nonumber\\
                 &=& E^Q\left[\frac{dP^A}{dP}x_g(t)\right] = E^Q\left[\frac{A(t)/A(0)}{B(t)}x_g(t)\right]\nonumber\\
                 &=& \frac{1}{A(0)}\sum_{n=0}^{N-1}\tau_n E^Q\left[\frac{P(t,T_{n+1})}{B(t)}x_g(t)\right]\nonumber\\
                 &=& \frac{1}{A(0)}\sum_{n=0}^{N-1}\tau_n E^{T_{n+1}}\left[\frac{dP}{dP^{T_{n+1}}}\frac{P(t,T_{n+1})}{B(t)}x_g(t)\right]\nonumber\\
                 &=& \frac{1}{A(0)}\sum_{n=0}^{N-1}\tau_n E^{T_{n+1}}\left[\frac{B(t)}{P(t,T_{n+1})/P(0,T_{n+1})}\frac{P(t,T_{n+1})}{B(t)}x_g(t)\right]\nonumber\\
                 &=& \sum_{n=0}^{N-1}\frac{\tau_nP(0,T_{n+1})}{A(0)}E^{T_{n+1}}\left[x_g(t)\right]\nonumber\\
                 &=& \sum_{n=0}^{N-1}\frac{\tau_nP(0,T_{n+1})}{A(0)}H(t)
                      \int_0^tH^{-1}(u)\left(\bar{y}(u)I_{d \times 1}-\left(\sigma_x^0(u)\right)^{\top}\sigma_x^0(u)G(u,T)\right)du.
    \end{eqnarray}

    Now, we can proceed to develop further approximation for the swap rate dynamics, around $\bar{x}(t)$ and $\bar{y}(t)$. Let us define $S_g(t)$ to be the Gaussian
    approximation to $S(t)$, and its dynamics will be represented by
    \begin{equation}
      dS_g(t)=\nabla S(\sigma_x^0)^{\top}dW^A(t).
    \end{equation}
    Expand Eq. (\ref{local})
    to first order in $x$,
    \begin{eqnarray}
      &&\Big((\nabla S) c_x (\nabla S)^{\top}\Big)\left(t,x(t),y(t)\right)
        \approx \Big((\nabla S) c_x (\nabla S)^{\top}\Big)\left(t,\bar{x}(t),\bar{y}(t)\right)\nonumber\\
        &&\quad\quad\quad\quad\quad\quad +\left.\nabla\Big((\nabla S) c_x (\nabla S)^{\top}\Big)\right|_{\left(t,\bar{x}(t),\bar{y}(t)\right)}\left(x(t)-\bar{x}(t)\right).
    \end{eqnarray}
    Then,
    \begin{eqnarray}
      && E^A\bigg[\left.(\nabla S) c_x (\nabla S)^{\top}\right|S(t)=s\bigg]
          \approx \Big((\nabla S) c_x (\nabla S)^{\top}\Big)\left(t,\bar{x}(t),\bar{y}(t)\right)\nonumber\\
        &&\quad\quad\quad\quad\quad\quad +\left.\nabla\Big((\nabla S) c_x (\nabla S)^{\top}\Big)\right|_{\left(t,\bar{x}(t),\bar{y}(t)\right)}
              E^A\Big[x(t)-\bar{x}(t)|S(t)=s\Big].
    \end{eqnarray}
    Using a Gaussian approximation for the conditional expectation,
    \begin{eqnarray}
      E^A\Big[x(t)-\bar{x}(t)|S(t)=s\Big] &\approx& E^A\Big[x_g(t)-\bar{x}_g(t)|S_g(t)=s\Big]\nonumber\\
                &=& \frac{{\rm Cov}\left(S_g(t),x_g(t)\right)}{{\rm Var}\left(S_g(t)\right)}\left(s-S(0)\right)\nonumber\\
                &=& \frac{c_x\left(\nabla S\right)^{\top}}{(\nabla S) c_x (\nabla S)^{\top}}\left(s-S(0)\right).
    \end{eqnarray}
    Notice that
    \begin{equation}
      \nabla\Big((\nabla S) c_x (\nabla S)^{\top}\Big)c_x\left(\nabla S\right)^{\top}
        = (\nabla S) d_x (\nabla S)^{\top} + 2(\nabla S) c_x (\nabla^2 S) c_x (\nabla S)^{\top},
    \end{equation}
    where
    \begin{equation}
      d_x=\sum_{l=1}^d \Big(c_x (\nabla S)^{\top}\Big)_l
                \left(\frac{\partial \sigma_x^{\top}}{\partial x_l}\sigma_x+\sigma_x^{\top}\frac{\partial \sigma_x}{\partial x_l}\right).
    \end{equation}
    The local volatility function is
    \begin{equation}
      \varphi^2(t,s)=(\nabla S) c_x (\nabla S)^{\top}
          + \frac{(\nabla S) d_x (\nabla S)^{\top} + 2(\nabla S) c_x (\nabla^2 S) c_x (\nabla S)^{\top}}
                 {(\nabla S) c_x (\nabla S)^{\top}}\left(s-S(0)\right),
    \end{equation}
    and linearizing around $s\approx S(0)$,
    \begin{eqnarray}
      \varphi(t,s)&=&\bigg((\nabla S) c_x (\nabla S)^{\top}\bigg)^{1/2}
                      + \frac{1}{2\bigg((\nabla S) c_x (\nabla S)^{\top}\bigg)^{1/2}}\nonumber\\
          &&\quad\quad\quad\quad \times\frac{(\nabla S) d_x (\nabla S)^{\top} + 2(\nabla S) c_x (\nabla^2 S) c_x (\nabla S)^{\top}}
                                            {(\nabla S) c_x (\nabla S)^{\top}}\left(s-S(0)\right).
      \label{expansion}
    \end{eqnarray}
    Setting
    \begin{eqnarray}
      &&\lambda_S(t)=\frac{\varphi(t,S(0))}{S(0)}=\frac{1}{S(0)}\bigg((\nabla S) c_x (\nabla S)^{\top}\bigg)^{1/2}\left(t,\bar{x}(t),\bar{y}(t)\right),\\
      &&b_S(t)=S(0)\frac{\frac{\partial\varphi}{\partial s}(t,S(0))}{\varphi(t,S(0))}
              =\left.S(0)\frac{(\nabla S) d_x (\nabla S)^{\top} + 2(\nabla S) c_x (\nabla^2 S) c_x (\nabla S)^{\top}}
                                            {2(\nabla S) c_x (\nabla S)^{\top}(\nabla S) c_x (\nabla S)^{\top}}\right|_{t,\bar{x}(t),\bar{y}(t)},
    \end{eqnarray}
    the swap rate dynamics can be recast into a Heston form,
    \begin{equation}
      dS(t)=\sqrt{z(t)}\lambda_S(t)\Big(b_S(t)S(t)+\left(1-b_S(t)\right)S(0)\Big)dU^A(t),
    \end{equation}
    and the European swaption price can be obtained through the parameter averaging method.

  \subsection{Approximate Swap Rate Dynamics in Gaussian Short Rate Models}

    For Gaussian short rate models, the volatility is a deterministic function, and
    \begin{equation}
      dS(t) = \varphi(t,S(t)) dW^A(t),
    \end{equation}
    with $\varphi(t,S(t))$ identical to Eq. (\ref{local}).
    Set $x(t)$ in the above SDE to $\bar{x}(t)$ as discussed earlier, the swap rate dynamics can be reduced to
    a normal process. The European payer swaption price is then given by the Bachelier formula,
    \begin{equation}
      A(0)\Big[\left(S(0)-c\right)\Phi(d)+\sqrt{v}\phi(d)\Big],
    \end{equation}
    with
    \begin{equation}
      d=\frac{S(0)-c}{\sqrt{v}},\quad\quad v=\int_0^{T_0}\Big[(\nabla S)\sigma_x(t)^{\top}\sigma_x(t)(\nabla S)^{\top}\Big]dt.
    \end{equation}
    Similarly, we can also expand the $\varphi(t,S(t))$ term to the first order in $x(t)$ and obtain a
    shifted lognormal process for the swap rate, and the corresponding models parameters are identical to those in Eq. (\ref{expansion}).

  \subsection{Volatility Parameterization}

    The local volatility function $\sigma_x(t,x,y)$ still needs to be specified.
    To this end, we consider $d$ rolling benchmark rates, $f_i(t)\equiv f_i(t,t+\delta_i)$, $i=1,\cdots,d$, with
    $\delta_1<\cdots<\delta_d$. We require that the benchmark rates have the following dynamics,
    \begin{equation}
      df_i(t)=O(dt)+\sqrt{z(t)}\lambda_i^f(t)\Big(\alpha_i^f(t)+b_i^f(t)f_i(t)\Big)dU_i(t),
      \label{benchmark}
    \end{equation}
    with $U(t)$ is a $d$-dimensional Brownian motion, with correlation matrix $X^f(t)=\{\chi_{i,j}(t)\}$. Define the decomposition
    of $X^f$ as
    \begin{equation}
      X^f(t)=D^f(t)^{\top}D^f(t),
    \end{equation}
    and $H^f$ by
    \begin{equation}
      H^f(t)=\left(
                \begin{array}{c}
                  h(t+\delta_1)^{\top}\\
                  \vdots\\
                  h(t+\delta_d)^{\top}
                \end{array}
              \right),
    \end{equation}
    and $\sigma^f$ by
    \begin{equation}
      \sigma^f(t,f(t))={\rm diag}\left(
                \lambda_1^f(t)\Big(\alpha_1^f(t)+b_1^f(t)f_1(t)\Big),
                \cdots,
                \lambda_d^f(t)\Big(\alpha_d^f(t)+b_d^f(t)f_d(t)\Big)
              \right),
    \end{equation}
    then we can set
    \begin{equation}
      \sigma_r(t;\omega)^{\top}=\sqrt{z(t)}\sigma_x(t,x,y)^{\top}
                =\sqrt{z(t)}H(t)H^f(t)^{-1}\sigma^f(t,f(t))D^f(t)^{\top},
    \end{equation}
    to be consistent with the benchmark rates dynamics. To see this, let $f(t)=(f_1(t),\cdots,f_d(t))^{\top}$,
    and it can be shown from the bond reconstitution formula, Eq. (\ref{reconstitution}),
    \begin{equation}
      f(t)=f(0)+H^f(t)H(t)^{-1}\Big(x(t)+y(t)G(t,T)\Big).
    \end{equation}
    The dynamics is then given by
    \begin{eqnarray}
      df(t) &=& O(dt)+H^f(t)H(t)^{-1}dx(t)\nonumber\\
            &=& O(dt)+H^f(t)H(t)^{-1}\sigma_r(t;\omega)^{\top}dW(t)\nonumber\\
            &=& O(dt)+\sqrt{z(t)}\sigma^f(t,f(t))D^f(t)^{\top}dW(t),
    \end{eqnarray}
    consistent with Eq. (\ref{benchmark}).

    \subsubsection{Case 1: One Factor Model}

      For one factor model, there is only one benchmark rate, and we can simply write $\sigma_r$ as
      \begin{equation}
        \sigma_r(t;\omega)\equiv \sigma_r(t,x(t), y(t))=\sqrt{z(t)}\lambda_r(t)\big(\alpha_r(t)+b_r(t)x(t)\big),
      \end{equation}
      where $\alpha_r(t)$ is actually redundant and can be absorbed into $\lambda_r(t)$. We will get onto this shortly.

      In the one dimensional case, the matrix products appearing in the approximate swap rate dynamics (see Sec. \ref{qGS})
      will reduce to scalar products, and the result is given by
      \begin{eqnarray}
        \lambda_S(t)&=&\lambda_r(t)\frac{1}{S(0)}\frac{\partial S}{\partial x}\Big(t, \bar{x}(t),\bar{y}(t)\Big)\Big(\alpha_r(t)+b_r(t)\bar{x}(t)\Big),\\
        b_S(t)&=&\frac{S(0)}{\alpha_r(t)+b_r(t)\bar{x}(t)}\frac{b_r(t)}{\displaystyle \frac{\partial S}{\partial x}\Big(t, \bar{x}(t),\bar{y}(t)\Big)}
                +\frac{\displaystyle S(0)\frac{\partial^2 S}{\partial x^2}\Big(t, \bar{x}(t),\bar{y}(t)\Big)}
                {\displaystyle \left(\frac{\partial S}{\partial x}\Big(t, \bar{x}(t),\bar{y}(t)\Big)\right)^2},
      \end{eqnarray}
      and then the short rate dynamics takes the same form as in the multi-factor case.

      From the above result, we can see that the local swap rate skew is related to the local short rate skew, ignoring small terms, by
      \begin{equation}
        b_S(t)\approx\frac{S(0)}{\alpha_r(t)}\frac{b_r(t)}{\displaystyle\frac{\partial S}{\partial x}\Big(t, \bar{x}(t),\bar{y}(t)\Big)}.
      \end{equation}
      It will be convenient to have these two skews of the same order of magnitude. Therefore, we can choose $\alpha_r(t)$ to be the same as the swap rate,
      and scale $b_r(t)$ by $\partial S/\partial x$.

    \subsubsection{Case 2: Gaussian Model}

      For the volatility parameterization of Gaussian short rate models, we can simply choose the volatilities of
      the benchmark rates to be deterministic functions, $\lambda_i^f(t)$, $i=1,\cdots,d$.

  \subsection{Calibration}


\section{The Affine Model}

  \subsection{One-Factor Model}

    \subsubsection{Discount Bond Price}

      Consider the following short rate dynamics,
      \begin{equation}
        dr(t)=\kappa(t)\left(\theta(t)-r(t)\right)dt + \sigma(t)\sqrt{\alpha(t) + \beta(t) r(t)}dW(t),
      \end{equation}
      with some technical conditions which will be omitted here. The details can be found in \cite{AP}.

      Even though we are interested in the discount bond price (\ref{bond0}), let us consider the more general problem
      and find
      \begin{equation}
        g(t,T;c_1,c_2)={\rm E}_t^Q\left[\exp\left(-c_1r(T)-c_2\int_t^Tr(u)du\right)\right],
      \end{equation}
      which can be viewed as the joint characteristic function for $r(t)$ and $\int r(t)dt$. Then, the bond price can be
      obtained through
      \begin{equation}
        P(t,T)=g(t,T;0,1).
      \end{equation}
      The affine structure of the model enable us to write
      \begin{equation}
        g(t,T;c_1,c_2)=\exp\left(A(t,T;c_1, c_2) - B(t,T;c_1, c_2)r(t)\right),
      \end{equation}
      and the its PDE is given by
      \begin{equation}
        \frac{\partial g}{\partial t}+\kappa(t)\left(\theta(t)-r\right)\frac{\partial g}{\partial r}
            +\frac{1}{2}\sigma^2(t)(\alpha(t)+\beta(t) r)\frac{\partial^2g}{\partial r^2} = c_2rg.
      \end{equation}
      Matching terms, the above PDE reduces to the following system of Riccati ODEs,
      \begin{eqnarray}
        \frac{dA}{dt}-\kappa(t)\theta(t)B+\frac{1}{2}\alpha(t)\sigma^2(t)B^2&=&0,\\
        -\frac{dB}{dt}+\kappa(t)B+\frac{1}{2}\beta(t)\sigma^2(t)B^2&=&c_2,
      \end{eqnarray}
      subject to the terminal condition $A(T,T;c_1,c_2)=B(T,T;c_1,c_2)=0$. For constant model parameters, this system of ODEs can
      analytically solved.

    \subsubsection{European Option Pricing}

      Since caplest are equivalent to options on zero coupon bond, the joint characteristic function from last section can be used
      for simple option pricing by the Fourier transform method, as briefly discussed in Appendix \ref{fourier}. For European swaption,
      we will seek approximate swap rate martingale dynamics.

      To this end, we introduce another variable, $x(t)=r(t)-f(0,t)$, whose dynamics is given by
      \begin{equation}
        dx(t)=dr(t)-\frac{\partial f(0,t)}{\partial t}dt=\left(\omega(t)-\kappa(t)x(t)\right)dt+\sigma(t)\sqrt{\xi(t)+\beta(t) x(t)}dW(t),
      \end{equation}
      where $x(0)=0$, $\xi(t)=\alpha(t) +\beta(t) f(0,t)$, and
      \begin{equation}
        \omega(t)=\kappa(t)\theta(t)-\frac{\partial f(0,t)}{\partial t}-\kappa(t)f(0,t).
      \end{equation}
      Notice that even $\omega(t)$ contains the derivative of the initial forward rate, which is generally interpolated from market data and
      is likely not smooth, $\omega(t)$ is likely to be smooth. $\omega(t)$ ensures that the affine model will exactly match the initial
      yield curve, in contrast to $\theta(t)$.

      The swap rate dynamics is a martingale in the annuity measure, that is, in terms of $x(t)$,
      \begin{equation}
        dS(t)=\frac{\partial S}{\partial x}\sigma(t)\sqrt{\xi(t)+\beta(t) x(t)}dW^A(t).
      \end{equation}
      Similar to the quasi-Gaussian model, we can expand $S(t)$ around some point to the first order in $x(t)$,
      \begin{equation}
        S(t)\approx \zeta(t)+\chi(t)x(t).
      \end{equation}
      Then, the swap rate dynamics becomes
      \begin{eqnarray}
        dS(t)&\approx&\chi(t)\sigma(t)\sqrt{\xi(t)+\beta(t) \left(\frac{S(t)-\zeta(t)}{\chi(t)}\right)}dW^A(t)\nonumber\\
             &=& \sigma(t)\sqrt{\alpha_s(t)+\beta_s(t)S(t)}dW^A(t),
      \end{eqnarray}
      with
      \begin{equation}
        \alpha_s(t)=\xi(t)\chi^2(t)-\beta(t)\zeta(t)\chi(t), \quad \beta_s(t)=\beta(t)\chi(t).
      \end{equation}
      Since the value of a European payer swaption is, in the annuity measure,
      \begin{equation}
        A(0){\rm E}^A\left[\Big(S(T_0)-c\Big)^+\right],
      \end{equation}
      it can be valued using the Fourier transform method. Alternatively, it can also be valued by the parameter averaging (PA) method,
      as discussed in Appendix \ref{PA}.


\section{The Quadratic Gaussian Model}

  The quadratic Gaussian model can be obtained by having the short rate in a quadratic form,
  \begin{equation}
    r(t)=z(t)^{\top}\gamma(t)z(t)+h(t)^{\top}z(t)+a(t),
    \label{quadGaussian}
  \end{equation}
  where $\gamma(t)$ is a $d\times d$ symmetric matrix, $h(t)$ is a $d$-dimensional vector, and $a(t)$ is
  used to fit the initial yield curve. Here, the $d$-dimensional state variable $z(t)$ satisfies
  \begin{equation}
    dz(t)=g(t)^{\top}dW(t), \quad \quad z(0)=0,
  \end{equation}
  where $W(t)$ is a $d$-dimensional Brownian motion.

  \subsection{Relation to the Affine Model}

  To see the connection to the affine model, consider the one dimensional constant parameter case.
  In this case, Eq. (\ref{quadGaussian}) reduces to
  \begin{equation}
    r(t)=\gamma z^2(t)+hz(t)+a,
  \end{equation}
  which can be solved,
  \begin{equation}
    z(t)=\frac{\sqrt{h^2+4\gamma\big(r(t)-a\big)}-h}{2},
  \end{equation}
  by keeping the positive root. Then, it can be shown
  \begin{equation}
    dr(t)=\frac{1}{\gamma}\sqrt{h^2+4\gamma\big(r(t)-a\big)}g(t)dW(t),
  \end{equation}
  which is clearly affine.

  \subsection{Analytical Results}

  Due to the affine nature of the quadratic Gaussian model, the discount bond price is similarly given
  in a quadratic form,
  \begin{equation}
    P(t,T)=\exp\Big(-z(t)^{\top}\gamma(t,T)z(t)-h(t,T)^{\top}z(t)-a(t,T)\Big).
  \end{equation}
  Applying the Feynman-Kac theorem, the discount bond price satisfies the following PDE,
  \begin{equation}
    \frac{\partial P}{\partial t}+\frac{1}{2}\sum_{ijk}
    \frac{\partial^2P}{\partial z_i\partial z_j}g_{ki}(t)g_{kj}(t)=r(t)P.
  \end{equation}
  Calculate the derivatives and match the $z$ terms on both sides of the above equation, we will
  obtain a system of Riccati ODEs,
  \begin{eqnarray}
    && -\frac{d}{dt}\gamma(t,T) + 2\gamma(t,T)g(t)^{\top}g(t)\gamma(t,T)=\gamma(t),\\
    && -\frac{d}{dt}h(t,T) + 2\gamma(t,T)g(t)^{\top}g(t)h(t,T)=h(t),\\
    && -\frac{d}{dt}a(t,T) - {\rm Tr}\Big(\gamma(t,T)g(t)^{\top}g(t)\Big) + \frac{1}{2}h(t,T)^{\top}g(t)^{\top}g(t)h(t,T)=a(t),
  \end{eqnarray}
  with terminal conditions $\gamma(T,T)=0$, $h(T,T)=0$, and $a(T,T)=0$.



\section{The Libor Market Model (LMM)}

  $$\nabla\nabla$$

\appendix

  \section{Girsanov's Theorem}
  \label{Girsanov}

    Consider two measures $P$ and $P(\theta)$ related by a density
    \begin{equation}
      \zeta^{\theta}(t) = {\rm E}_t^P\left[\frac{dP(\theta)}{dP}\right],
    \end{equation}
    where $\zeta^{\theta}(t)$ is an exponential martingale given by
    \begin{equation}
      \frac{d\zeta^{\theta}(t)}{\zeta^{\theta}(t)}=-\theta(t)^{\top}dW(t),
    \end{equation}
    where $W(t)$ is a $d$-dimensional $P$-Brownian motion. Then,
    \begin{equation}
      W^{\theta}(t) = W(t)+\int_0^t\theta(s)ds
    \end{equation}
    is a $P(\theta)$-Brownian motion, and
    \begin{equation}
      dW^{\theta}(t) = dW(t)+ \theta(t)dt.
    \end{equation}

  \section{Futures Convexity Adjustment}

    \subsection{Ho-Lee Model}

      In the Ho-Lee model, $\sigma_P(t,T)=\sigma(T-t)$, and
      \begin{equation}
        \Omega(t,T)=\sigma^2\tau\int_t^T\left(T+\tau-u\right)du=\frac{\sigma^2}{2}(T-t)(T-t+2\tau)\tau.
      \end{equation}
      By expanding Eq. (\ref{ca}) to first order in $\tau$, the futures rate in the Ho-Lee model is given by
      \begin{equation}
        F(t,T,T+\tau)=L(t,T,T+\tau)+\frac{\sigma^2}{2}(T-t)(T-t+2\tau).
      \end{equation}

    \subsection{Vasicek Model}

      In the Vasicek model, the forward rate volatility function is set to
      $\sigma_f(t,T)=\sigma e^{-\kappa(T-t)}$.
      Therefore,
      \begin{equation}
        \sigma_P(t,T)=\frac{\sigma}{\kappa}\left(1-e^{-\kappa(T-t)}\right),
      \end{equation}
      and
      \begin{equation}
        \Omega(t,T)=\frac{\sigma^2}{\kappa^2}\int_t^T\left(e^{-\kappa(T-u)}-e^{-\kappa(T+\tau-u)}\right)
                                                            \left(1-e^{-\kappa(T+\tau-u)}\right)du.
      \end{equation}
      This can be shown to give
      \begin{equation}
        \Omega(t,T)=\frac{\sigma^2}{2\kappa^3}\left(1-e^{-\kappa\tau}\right)\left(1-e^{-\kappa(T-t)}\right)
                                              \left(2-e^{-\kappa\tau}-e^{-\kappa(T+\tau-t)}\right).
      \end{equation}
      The above result can be exactly reduced to the Ho-Lee model when taking the limit $\kappa\rightarrow 0$,
      while under this limit, the vasicek model also reduces to the Ho-Lee model.

    \subsection{Continuously Compounded Forward Rate}

      Rather than using the simply compounded forward rate, we can also formulate the convexity adjustment in terms of continuously
      compounded forward rate,
      \begin{equation}
        f(t,T,T+\tau) = -\frac{1}{\tau}\log\left(\frac{P(t,T+\tau)}{P(t,T)}\right)
                      = \frac{1}{\tau}\left(\log P(t,T)-\log P(t,T+\tau)\right),
      \end{equation}
      and the dynamics can be derived by simple application of Ito's lemma,
      \begin{equation}
        df(t,T,T+\tau) = \frac{\sigma_P^2(t,T+\tau)-\sigma_P^2(t,T)}{2\tau}dt
                       + \frac{\sigma_P(t,T+\tau)-\sigma_P(t,T)}{\tau}dW(t).
      \end{equation}
      Then, the expected change in the forward rate from $t$ to the expiry of the futures contract $T$, is
      given by the integral over the drift term,
      \begin{equation}
        {\rm ConvAdj}(t,T,T+\tau)=\frac{1}{2\tau}\int_t^T\left[\sigma_P^2(u,T+\tau)-\sigma_P^2(u,T)\right]du.
      \end{equation}

      For the Ho-Lee model, the convexity adjustment is given by
      \begin{equation}
        \frac{\sigma^2}{2}(T-t)(T-t+\tau),
      \end{equation}
      and the vasicek convexity adjustment is
      \begin{equation}
        \frac{\sigma^2}{4\kappa^3\tau}\left(1-e^{-\kappa\tau}\right)\left(1-e^{-\kappa(T-t)}\right)
                                      \left(3-e^{-\kappa\tau}-e^{-\kappa(T-t)}-e^{-\kappa(T-t+\tau)}\right).
      \end{equation}
      Again, in the $\kappa\rightarrow 0$ limit, this reduces to the Ho-Lee convexity adjustment.

  \section{Transform Method for Option Pricing}
  \label{fourier}

  aaa

  \section{Parameter Averaging Method for Option Pricing}
  \label{PA}

  bbb



\begin{thebibliography}{1}

\bibitem{AP} Leif Andersen and Vladimir Piterbarg, {\it Interest Rate Modeling}, Atlantic Financial Press, 2010.
\bibitem{BM} Damiano Brigo and Fabio Mercurio, {\it Interest Rate Models - Theory and Practice: With Smile, Inflation and Credit}, Springer, 2006.


\end{thebibliography}

\end{document}